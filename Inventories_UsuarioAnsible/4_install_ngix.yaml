---
- name: Install Nginx
  hosts: Rocky
  become: true
  tasks:
   - name: Configure firewall for http
     firewalld:
      service: http
      permanent: yes
      state: enabled

   - name: Configure firewall for https
     firewalld:
      service: https
      permanent: yes
      state: enabled

  handlers:
   - name: Reload firewalld
     firewalld:
        state: reload

   - name: Install Nginx
     dnf:
      name: nginx
      state: present

   - name: Copy Nginx configuration
     template:
      src: nginx.conf.j2
      dest: /etc/nginx/nginx.conf
     notify: Restart Nginx

   - name: Generate SSL certificate and key
     command: "openssl req -x509 -nodes -days 365 -newkey rsa:2048 -keyout /etc/nginx/ssl/nginx-selfsigned.key -out /etc/nginx/ssl/nginx-selfsigned.crt"

  handlers:
    - name: Restart Nginx
      service:
        name: nginx
        state: restarted
